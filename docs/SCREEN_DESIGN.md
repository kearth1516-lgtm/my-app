# 画面設計書

## 概要
本アプリケーションは、タイマー機能を中心とした時間管理アプリケーションです。ユーザーが学習や運動などの活動時間を記録し、タグで分類して管理できます。

---

## 画面一覧

### 1. ホーム画面 (`/`)
**目的**: アプリケーションのトップページ。メイン機能へのナビゲーション。

#### レイアウト
- **ヘッダー**
  - タイトル: "🏠 マイアプリ"
  - サブタイトル: "趣味を管理しよう"
  - 設定ボタン（⚙️）: 右上に配置、設定画面へ遷移

- **メイン画像エリア**
  - 白い背景のカード
  - ランダムな画像を表示（タイマーに登録された画像からランダム選択）
  - 画像が存在しない場合は「画像を追加してください」メッセージ

- **メニュー**
  - グリッド表示（2列または自動調整）
  - 各メニューアイテムは半透明の白背景
  - アイコン + ラベル形式
  - メニュー項目:
    - ⏱️ タイマー (`/timers`)
    - 🍳 レシピ (`/recipes`)
    - 👔 ファッション (`/fashion`) ※準備中

#### スタイル
- 背景: テーマカラーのグラデーション（`var(--theme-gradient)`）
- 文字色: テーマに応じた色（`var(--theme-text-color)`）
- ホバー効果: 上方向に5px移動

---

### 2. タイマー一覧画面 (`/timers`)
**目的**: 登録されたタイマーの一覧表示と管理。

#### レイアウト
- **ヘッダー**
  - タイトル: "⏱️ タイマー"
  - お気に入りフィルターボタン: "☆ すべて" / "⭐ お気に入りのみ" 切り替え
  - 新規作成ボタン: 右側に配置

- **タイマーカード（Flexboxレイアウト）**
  - 横5列まで表示（レスポンシブ、最小幅280px）
  - ドラッグ&ドロップで並び替え可能（全表示時のみ）
  - 各カードの構成:
    - ドラッグハンドル（⋮⋮）: 左上、全表示時のみ表示
    - お気に入りボタン（⭐/☆）: 右上
    - 画像エリア（高さ200px）
    - 編集ボタン（✏️）: 右上
    - 削除ボタン（×）: 右上（ストップウォッチは非表示）
    - タイマー名
    - タイマー表示（HH:MM:SS形式）
    - 操作ボタン:
      - 開始ボタン（緑系、テーマのsuccess色）
      - 停止ボタン（赤系、テーマのdanger色）
    - 統計情報: 「記録回数: X回」

- **底部ナビゲーション**
  - ホームへ戻るボタン
  - 記録画面へのリンク

#### 特殊なタイマー
- **ストップウォッチ（固定）**
  - ID: `stopwatch-fixed`
  - デフォルトで存在
  - 削除不可
  - カウントアップ方式（00:00から開始）
  - 編集で画像のみ変更可能

#### 新機能
- **ドラッグ&ドロップ並び替え**
  - ライブラリ: @hello-pangea/dnd
  - 複数行対応（flexboxレイアウト）
  - お気に入りフィルター表示時は無効化
  - ドラッグ中の視覚フィードバック
  - 並び順はサーバーに自動保存

- **お気に入り機能**
  - ⭐/☆ボタンで切り替え
  - フィルター表示機能（お気に入りのみ表示）
  - isFavoriteフィールドで管理

- **タグ管理**
  - 停止時にタグを選択/新規作成
  - タグは全タイマーで共有
  - タグ一覧はサーバーから取得

#### 機能
- タイマー開始: カウントダウン/カウントアップ開始、全画面表示へ遷移
- タイマー停止: 記録保存モーダル表示（タグ選択可能）
- タイマー削除: 確認モーダル表示後削除
- タイマー編集: 編集モーダル表示
- カードクリック: 詳細画面へ遷移
- お気に入り切り替え: 即座に反映、サーバー保存
- 並び替え: ドラッグ&ドロップで順序変更、自動保存
- **タイマー終了時**:
  - アラート音が5秒間2秒ごとに繰り返し再生
  - タイマー終了モーダル表示
  - OKボタン: アラート停止、記録保存モーダルへ
  - 続けるボタン: アラート停止、タイマー再開（マイナスカウント）
- **マイナスカウント**:
  - カウントダウンタイマーが0になっても続行
  - マイナス時間で表示（例: -00:00:30）
  - 記録保存時は合計時間を記録（5秒タイマー+30秒超過=35秒）

#### スタイル
- 背景: テーマカラーのグラデーション
- タイマーカード: 白背景、ホバー時に上方向へ5px移動
- ドラッグ中: 影を強調、半透明化
- タイマー表示: 等幅フォント、テーマのprimary色
- レイアウト: Flexbox（flex-wrap: wrap）で複数行対応

---

### 3. タイマー実行中画面（全画面表示）
**目的**: タイマー実行中の進捗を全画面で視覚的に表示。

#### レイアウト
- **背景**
  - タイマーの画像を背景として表示（ぼかし効果）
  - オーバーレイで半透明の暗い背景

- **メインコンテンツ**
  - タイマー名（上部、大きく表示）
  - 円形プログレスバー（中央）:
    - 直径300px
    - カウントダウンタイマー: 進捗を円周で表示
    - ストップウォッチ: プログレスバーなし
    - マイナス時間の場合: 100%（完了状態）
  - 時間表示（円の中央）:
    - HH:MM:SS形式
    - 等幅フォント、大きく表示
    - マイナス時間は先頭に`-`を表示

- **コントロールボタン（下部）**
  - 一時停止/再開ボタン: 「⏸ 一時停止」/「▶ 再開」
  - 停止ボタン: 「■ 停止」

- **統計情報（最下部）**
  - カウントダウンタイマー:
    - 設定時間
    - 経過時間
    - マイナス時の超過時間（赤色強調）
  - ストップウォッチ:
    - 経過時間のみ

#### 機能
- 一時停止/再開: タイマーのカウントを一時停止・再開
- 停止: タイマーを停止し、記録保存モーダル表示
- リアルタイム更新: 1秒ごとに時間とプログレスバー更新
- マイナスカウント: 0以降もカウントダウン継続

#### スタイル
- 全画面表示（position: fixed、z-index高）
- 背景画像: ぼかし効果（filter: blur(10px)）
- プログレスバー: SVGで描画、アニメーション付き
- ボタン: 半透明の白背景、大きめのサイズ

---

### 4. タイマー詳細画面 (`/timers/:id`)
**目的**: 特定のタイマーの詳細情報と記録履歴の表示。

#### レイアウト
- **ヘッダー**
  - 戻るボタン: 左上
  - タイマー名

- **タイマー情報カード**
  - ヒーロー画像（高さ300px）
  - 統計サマリー（グリッド表示）:
    - 総記録回数
    - 総時間
    - 平均時間

- **記録セクション**
  - タイトル: "📝 記録一覧"
  - 記録がない場合: 「まだ記録がありません」メッセージ
  - 記録リスト:
    - 記録番号（円形バッジ、テーマのprimaryグラデーション）
    - 開始時刻・終了時刻
    - 経過時間（大きく強調、テーマのprimary色）
    - タグ（存在する場合）

- **底部ナビゲーション**
  - ホームへ戻る
  - タイマー一覧へ戻る

#### スタイル
- 背景: テーマカラーのグラデーション
- 情報カード: 白背景
- 記録アイテム: グラデーション背景（#f5f7fa → #e8edf3）
- ホバー効果: 右方向へ5px移動

---

### 4. 設定画面 (`/settings`)
**目的**: アプリケーション全体の設定管理。

#### レイアウト
- **ヘッダー**
  - タイトル: "⚙️ 設定"

- **設定コンテンツ**
  - 最大幅800px、中央揃え

- **アラート音セクション**
  - セクションタイトル: "🔔 アラート音"
  - 説明文: "タイマー終了時のアラート音を設定できます"
  - ON/OFFトグルスイッチ
  - 音量スライダー（0-100%）
  - 音の種類選択（4種類）:
    - ビープ: シンプルな音
    - ベル: 2音階の音
    - チャイム: 3音階の和音（C-E-G）
    - デジタル: 短い連続音
  - プレビューボタン: 選択した音を試聴

- **テーマカラーセクション**
  - セクションタイトル: "テーマカラー"
  - 説明文: "アプリ全体のカラーテーマを選択できます"
  - テーマオプション（グリッド表示）:
    - 12色のテーマ
    - 各オプション:
      - プレビュー（80px高さ、グラデーション表示）
      - テーマ名
      - 選択中の場合: 白い枠線 + チェックマーク（✓）

#### テーマ一覧
| ID | 名前 | 文字色 | 主な用途 |
|---|---|---|---|
| red | レッド | 白 | 情熱的な雰囲気 |
| blue | ブルー | 白 | 落ち着いた雰囲気 |
| yellow | イエロー | 黒 | 明るく活発な雰囲気 |
| green | グリーン | 黒 | 自然で穏やかな雰囲気 |
| pink | ピンク | 黒 | 柔らかく優しい雰囲気 |
| cyan | スカイ | 黒 | 爽やかな雰囲気 |
| orange | オレンジ | 黒 | 元気で活動的な雰囲気 |
| lime | ライム | 黒 | フレッシュな雰囲気 |
| purple | パープル | 白 | 高級感のある雰囲気 |
| black | ブラック | 白 | シックでモダンな雰囲気 |
| white | ホワイト | 黒 | シンプルで清潔な雰囲気 |
| brown | ブラウン | 白 | 温かみのある雰囲気 |

#### テーマカラーパレット構成
各テーマは以下の5色で構成:
- **primary**: メインカラー（明るめ）
- **primaryDark**: メインカラー（濃いめ）
- **accent**: アクセントカラー
- **success**: 成功・開始ボタン用
- **danger**: 警告・停止ボタン用

#### 底部ナビゲーション
- ホームへ戻る

#### 機能
- テーマ選択: クリックで即座にテーマ変更、API保存
- アラート音設定:
  - ON/OFF切り替え、即座にAPI保存
  - 音量調整（0.0-1.0）、即座にAPI保存
  - 音の種類変更、即座にAPI保存
  - プレビュー再生：Web Audio APIで即座に再生
- 保存中インジケーター: 画面下部に表示

#### スタイル
- 背景: テーマカラーのグラデーション
- セクション: 半透明の白背景、ぼかし効果
- 文字色: テーマに応じて自動調整

---

### 5. 記録画面 (`/records`)
**目的**: 全タイマーの記録を一覧表示、集計、分析。

#### レイアウト
- **ヘッダー**
  - タイトル: "📊 記録"
  - 手動追加ボタン: "＋ 手動で追加"

- **タブ切り替え**
  - グラフビュー（デフォルト）
  - リストビュー

- **フィルターセクション**
  - タグフィルター:
    - "すべて"（デフォルト）
    - 登録済みタグのリスト
  - サマリー情報:
    - 記録数
    - 総時間

- **グラフビュー**
  - 日別の積み上げ棒グラフ
  - 横軸: 日付
  - 縦軸: 時間（時間単位）
  - タイマーごとに色分け
  - 日付クリックで詳細モーダル表示

- **カレンダービュー**
  - 月別のカレンダー表示
  - 各日付セル:
    - 記録がある日は強調表示
    - スタンプ表示（最大3つ、重複除外）
    - 記録件数と総時間
  - 今日の日付はハイライト
  - 月切り替えナビゲーション（前月・次月・今日）
  - 日付クリックで詳細モーダル表示

- **レポートビュー**
  - 週次・月次の統計表示
  - 総時間の棒グラフ（週別/月別）
  - タイマー別分布（円グラフ）
  - タグ別分布（円グラフ）
  - ボタンで表示切り替え（週次/月次）

- **リストビュー**
  - 日付ごとにグループ化
  - 各日付セクション:
    - 日付ヘッダー（曜日付き）
    - その日の合計時間
    - 記録リスト（タイマー名、時間、タグ）
    - 日付クリックで詳細モーダル表示

- **底部ナビゲーション**
  - ホームへ戻る

#### 機能
- **手動記録追加**
  - ストップウォッチのみ選択可能
  - 時分秒で時間入力
  - 日時選択
  - タグ選択/新規作成
  - スタンプ選択（絵文字、24種類から選択可能）

- **記録詳細表示**
  - 日付クリックで詳細モーダル表示
  - その日の全記録を表示
  - 個別記録の編集・削除

- **フィルタリング**
  - タグで絞り込み
  - サマリー情報も連動更新

#### スタイル
- 背景: テーマカラーのグラデーション
- グラフ: Recharts使用、カラフルな色分け
- 記録カード: 白背景、ホバー効果
- 日付ヘッダー: テーマのprimaryグラデーション

---

### 6. レシピ画面 (`/recipes`)
**目的**: レシピの管理（作成・編集・削除・閲覧）。

#### レイアウト
- **ヘッダー**
  - タイトル: "🍳 レシピ"
  - お気に入りフィルターボタン: "☆ すべて" / "⭐ お気に入りのみ" 切り替え
  - 新規作成ボタン: 右側に配置
  - URLから取り込みボタン: "🌐 URLから取り込み"（緑系）
  - AI提案ボタン: "✨ AI提案"（オレンジ系）

- **検索バー**
  - 中央配置、最大幅600px
  - プレースホルダー: "🔍 レシピ名、材料、タグで検索..."
  - クリアボタン（×）: 入力時のみ表示
  - リアルタイム検索（入力ごとに自動検索）

- **レシピカード（グリッドレイアウト）**
  - 横3列まで表示（レスポンシブ、最小幅300px）
  - カード全体がクリッカブル（詳細表示へ遷移）
  - 各カードの構成:
    - お気に入りボタン（⭐/☆）: 右上
    - レシピ名（大きく表示）
    - 材料プレビュー: 最初の3つを表示
    - 手順プレビュー: 最初の2つを表示
    - 調理時間: ⏱️アイコン + 分表示
    - タグ表示: 🏷️アイコン + タグリスト
    - 統計情報: 「作った回数: X回」
    - 操作ボタン:
      - 今日作ったボタン（緑系グラデーション）
      - 編集ボタン（✏️、紫系グラデーション）
      - 削除ボタン（🗑️、赤系）
  - ホバー効果: 上方向へ5px移動、ポインターカーソル表示
  - ボタンクリック時: イベント伝播停止（詳細表示を開かない）

- **底部ナビゲーション**
  - ホームへ戻るボタン

#### 機能
- **レシピ作成**: 新規作成ボタンからモーダル表示
- **レシピ編集**: 編集ボタンからモーダル表示
- **レシピ削除**: 削除ボタンから確認後削除
- **レシピ詳細表示**: カードクリックで詳細モーダル表示（材料・手順の完全表示）
- **お気に入り切り替え**: ⭐/☆ボタンで即座に切り替え、サーバー保存
- **お気に入りフィルター**: お気に入りのみ表示
- **今日作った**: 調理回数をカウント、サーバー保存
- **検索機能**: 
  - レシピ名、材料、手順、タグから部分一致検索
  - リアルタイム検索（入力時に即座に反映）
  - お気に入りフィルターと併用可能
- **URLから取り込み**:
  - クックパッド、楽天レシピ対応
  - 汎用スクレイパー（schema.org対応サイト）
  - 取り込み内容を確認後に保存
- **AI提案**:
  - 材料を入力してレシピ生成
  - OpenAI API（GPT-3.5-turbo）使用
  - 生成内容を確認後に保存

#### スタイル
- 背景: テーマカラーのグラデーション
- レシピカード: 白背景、角丸15px、ホバー時に上方向へ5px移動
- レイアウト: Grid（自動配置、最小幅300px、最大幅1fr）
- 材料・手順プレビュー: 小さめのフォント、薄いグレー背景
- 検索バー: 白背景、角丸25px、フォーカス時にテーマカラーのボーダー
- ボタン:
  - 新規作成: テーマのprimaryグラデーション
  - URLから取り込み: 緑系グラデーション
  - AI提案: オレンジ系グラデーション

---

## モーダル一覧

### 12. レシピ作成/編集モーダル
**トリガー**: レシピ画面の「新規作成」ボタンまたはカードの編集ボタン（✏️）

#### 構成
- **ヘッダー**
  - タイトル: "🍳 新しいレシピ" / "🍳 レシピを編集"
  - 閉じるボタン（×）

- **フォーム**
  - レシピ名（必須）: 1行入力欄
  - 材料（1行に1つ）: テキストエリア（5行）
  - 手順（1行に1つ）: テキストエリア（6行）
  - 調理時間（分）: 数値入力（オプション）
  - 参考URL: テキスト入力（オプション）
  - タグ（カンマ区切り）: テキスト入力（オプション）

- **アクション**
  - キャンセルボタン（半透明の白）
  - 作成/更新ボタン（テーマのprimary→primaryDarkグラデーション）

#### バリデーション
- レシピ名: 必須

#### スタイル
- 背景: テーマカラーのグラデーション
- 入力フィールド: 白背景、2px solid #e0e0e0のボーダー
- ラベル: 中太字、テーマに応じた文字色
- プレースホルダー: 具体例を表示

---

### 12.5. レシピ詳細表示モーダル
**トリガー**: レシピカードのクリック

#### 構成
- **ヘッダー**
  - タイトル: "🍳 [レシピ名]"
  - 閉じるボタン（×）

- **詳細コンテンツ**
  - 基本情報（グリッド表示）:
    - 調理時間（存在する場合）
    - 調理回数
    - お気に入りステータス
  - タグ一覧（存在する場合）
  - 材料リスト（全件表示）:
    - グレー背景、角丸8px
    - 各材料を1行ずつ表示
  - 手順リスト（全件表示）:
    - 番号付きリスト（ol要素）
    - 各手順に円形の番号アイコン（テーマカラー）
    - 左パディング50pxで番号とテキストを整列
  - 参照元URL（存在する場合）:
    - リンク形式で表示

- **アクション**
  - 閉じるボタン
  - 編集ボタン（編集モーダルへ遷移）

#### スタイル
- 最大幅: 800px
- コンテンツエリア: 最大高さ90vh-180px、スクロール可能
- セクション区切り: 下線付き見出し
- 手順番号: 円形（直径28px）、テーマカラー背景、白文字
- 情報カード: グレー背景、角丸10px、アイコン付き

---

### 13. URLから取り込みモーダル
**トリガー**: レシピ画面の「🌐 URLから取り込み」ボタン

#### 構成
- **ヘッダー**
  - タイトル: "🌐 URLからレシピを取り込む"
  - 閉じるボタン（×）

- **取り込みフォーム（取り込み前）**
  - 説明文: "クックパッド、楽天レシピなどのレシピURLを入力してください"
  - URL入力欄: type="url"、プレースホルダー付き
  - アクション:
    - キャンセルボタン
    - 取り込むボタン（ローディング表示対応）

- **取り込み内容確認（取り込み後）**
  - タイトル: "取り込み内容の確認"
  - プレビュー表示:
    - レシピ名
    - 材料件数
    - 手順件数
    - 調理時間（存在する場合）
    - タグ（存在する場合）
  - アクション:
    - やり直しボタン
    - 保存するボタン

#### 対応サイト
- クックパッド（cookpad.com）
- 楽天レシピ（recipe.rakuten.co.jp）
- 汎用（schema.org対応サイト）

#### エラーハンドリング
- URLが空: アラート表示
- スクレイピング失敗: エラーメッセージ表示

#### スタイル
- 最大幅: 600px
- プレビュー: グレー背景、角丸8px

---

### 13.5 レシピ詳細表示モーダル
**トリガー**: レシピカードのクリック

#### 構成
- **ヘッダー**
  - タイトル: "🍳 [レシピ名]"
  - 閉じるボタン（×）

- **詳細コンテンツ**
  - 基本情報（グリッド表示）:
    - 調理時間（存在する場合）
    - 調理回数
    - お気に入りステータス
  - タグ一覧（存在する場合）
  - 材料リスト（全件表示）:
    - グレー背景、角丸8px
    - 各材料を1行ずつ表示
  - 手順リスト（全件表示）:
    - 番号付きリスト（ol要素）
    - 各手順に円形の番号アイコン（テーマカラー）
    - 左パディングで番号とテキストを整列
  - 参照元URL（存在する場合）:
    - リンク形式で表示

- **アクション**
  - 閉じるボタン
  - 編集ボタン（編集モーダルへ遷移）

#### スタイル
- 最大幅: 800px
- コンテンツエリア: 最大高さ90vh-180px、スクロール可能
- セクション区切り: 下線付き見出し
- 手順番号: 円形（幅28px）、テーマカラー背景、白文字

---

### 13.5 レシピ詳細表示モーダル
**トリガー**: レシピカードのクリック

#### 構成
- **ヘッダー**
  - タイトル: "🍳 [レシピ名]"
  - 閉じるボタン（×）

- **詳細コンテンツ**
  - 基本情報（グリッド表示）:
    - 調理時間（存在する場合）
    - 調理回数
    - お気に入りステータス
  - タグ一覧（存在する場合）
  - 材料リスト（全件表示）:
    - グレー背景、角丸8px
    - 各材料を1行ずつ表示
  - 手順リスト（全件表示）:
    - 番号付きリスト（ol要素）
    - 各手順に円形の番号アイコン（テーマカラー）
    - 左パディングで番号とテキストを整列
  - 参照元URL（存在する場合）:
    - リンク形式で表示

- **アクション**
  - 閉じるボタン
  - 編集ボタン（編集モーダルへ遷移）

#### スタイル
- 最大幅: 800px
- コンテンツエリア: 最大高さ90vh-180px、スクロール可能
- セクション区切り: 下線付き見出し
- 手順番号: 円形（直径28px）、テーマカラー背景、白文字
- 情報カード: グレー背景、角丸10px、アイコン付き

---

### 14. AI提案モーダル
**トリガー**: レシピ画面の「✨ AI提案」ボタン

#### 構成
- **ヘッダー**
  - タイトル: "✨ AIレシピ提案"
  - 閉じるボタン（×）

- **材料入力フォーム（生成前）**
  - 説明文: "手持ちの材料を入力すると、AIがレシピを提案します"
  - 材料入力:
    - テキストエリア（6行）
    - プレースホルダー: 具体例表示
    - ローディング中は無効化
  - エラー表示エリア（API未設定時など）
  - アクション:
    - キャンセルボタン
    - レシピを生成ボタン（ローディング表示対応）

- **提案内容確認（生成後）**
  - タイトル: "提案されたレシピ"
  - プレビュー表示:
    - レシピ名
    - 材料件数
    - 手順件数
    - 調理時間（存在する場合）
    - タグ（"AI提案"タグが自動付与）
  - アクション:
    - やり直しボタン
    - 保存するボタン

#### AI仕様
- モデル: OpenAI GPT-3.5-turbo
- 温度: 0.7
- 最大トークン: 1000
- 出力形式: JSON
- 自動タグ: "AI提案"

#### エラーハンドリング
- 材料が空: アラート表示
- API未設定: 503エラー、専用メッセージ表示
- その他エラー: エラーメッセージ表示

#### スタイル
- 最大幅: 600px
- エラーメッセージ: 赤系背景、角丸8px

---

### 1. タイマー作成モーダル
**トリガー**: タイマー一覧画面の「新規作成」ボタン

#### 構成
- **ヘッダー**
  - タイトル: "⏱️ 新しいタイマー"
  - 閉じるボタン（×）

- **フォーム**
  - タイマー名（必須）
  - 時間設定:
    - 時（0-23）
    - 分（0-59）
    - 秒（0-59）
  - 画像プレビュー
  - ファイル選択ボタン

- **アクション**
  - キャンセルボタン（半透明の白）
  - 作成ボタン（テーマのprimary→primaryDarkグラデーション）

#### バリデーション
- タイマー名: 必須
- 時間: 最低1秒以上

#### スタイル
- 背景: テーマカラーのグラデーション
- 入力フィールド: 半透明の白背景
- 文字色: テーマに応じて自動調整

---

### 2. タイマー編集モーダル
**トリガー**: タイマーカードの編集ボタン（✏️）

#### 構成
- タイマー作成モーダルと同様のレイアウト
- タイトル: "⏱️ タイマー編集"
- 既存データが入力済み

#### 制約
- **ストップウォッチの場合**: 画像のみ編集可能（名前・時間は変更不可）

#### アクション
- キャンセルボタン
- 更新ボタン（テーマのprimaryグラデーション）

---

### 3. 記録保存モーダル
**トリガー**: タイマー停止時

#### 構成
- **ヘッダー**
  - タイトル: "📝 記録を保存"
  - テーマカラーのグラデーション背景

- **記録情報**
  - タイマー名
  - 経過時間（大きく表示、テーマのprimary色）

- **タグ選択**
  - ラベル: "タグ（任意）"
  - セレクトボックス:
    - "タグなし"（デフォルト）
    - 既存タグのリスト
    - "新しいタグを追加..."
  - 新規タグ入力フィールド（条件表示）

- **スタンプ選択**
  - ラベル: "スタンプ（オプション）"
  - グリッド表示（最大24種類）
  - 選択したスタンプは枠線で強調
  - 「なし」ボタンで未選択状態に
  - 利用可能なスタンプ:
    👍, ✨, 🔥, 🎉, ❤️, 🏆, 💪, 🚀,
    🌟, 🌈, 🌻, 🎓, 📚, ✏️, 🎵, ⚽,
    🏀, 🏋️, 🎨, 💻, ☕, 🍔, 🌞, 🌙

- **コメント入力**
  - ラベル: "コメント・メモ（オプション）"
  - テキストエリア（3行）
  - 文字数カウント表示（最大500文字）
  - プレースホルダー: "この記録についてメモを残す..."

- **アクション**
  - キャンセルボタン
  - 保存ボタン（テーマのprimaryグラデーション）

#### 機能
- タグなしで保存可能
- 新規タグ追加可能（その場で登録）
- タグは全タイマーで共有
- コメント・メモの追加（オプション、最大500文字）

---

### 6. 手動記録追加モーダル
**トリガー**: 記録画面の「＋ 手動で追加」ボタン

#### 構成
- **ヘッダー**
  - タイトル: "📝 手動で記録を追加"
  - 閉じるボタン（×）

- **フォーム**
  - タイマー選択: ストップウォッチのみ（自動選択、変更不可）
  - 時間入力:
    - 時（0-23）
    - 分（0-59）
    - 秒（0-59）
  - 日時選択: datetime-local入力
  - タグ選択:
    - "タグなし"（デフォルト）
    - 既存タグのリスト
    - "新しいタグを追加..."
  - スタンプ選択: グリッド表示（24種類の絵文字）
  - コメント入力:
    - ラベル: "コメント・メモ（オプション）"
    - テキストエリア（3行）
    - 文字数カウント表示（最大500文字）
    - プレースホルダー: "この記録についてメモを残す..."

- **アクション**
  - キャンセルボタン
  - 追加ボタン（テーマのprimaryグラデーション）

#### バリデーション
- 時間: 最低1秒以上
- 日時: 必須

---

### 7. 記録詳細モーダル
**トリガー**: 記録画面のグラフ/リストで日付クリック

#### 構成
- **ヘッダー**
  - タイトル: "YYYY年M月D日の記録"
  - 閉じるボタン（×）

- **サマリー**
  - 記録数: X件
  - 合計時間: X時間Y分Z秒

- **記録リスト**
  - 各記録:
    - タイマー名（⏱️アイコン付き）
    - スタンプ（存在する場合、大きく表示）
    - タグ（🏷️アイコン付き、存在する場合）
    - 時間（🕐アイコン付き）
    - 開始時刻（📅アイコン付き）
    - コメント（💬アイコン付き、存在する場合）
    - 編集ボタン（✏️）
    - 削除ボタン（🗑️）

- **アクション**
  - 閉じるボタン

#### 機能
- 個別記録の編集: 編集モーダル表示
- 個別記録の削除: 確認モーダル表示後削除

#### スタイル
- 最大幅: 700px
- 記録アイテム: 白背景、ホバー時に枠線色変更
- 編集・削除ボタン: 右側に並列配置

---

### 8. 記録編集モーダル
**トリガー**: 記録詳細モーダルの編集ボタン（✏️）

#### 構成
- **ヘッダー**
  - タイトル: "記録を編集"
  - 閉じるボタン（×）

- **フォーム**
  - タイマー名: 変更不可（グレーアウト）
  - 時間編集:
    - 時（0-23）
    - 分（0-59）
    - 秒（0-59）
  - 日付選択: date入力
  - タグ選択:
    - "タグなし"
    - 既存タグのリスト
    - "新しいタグを追加..."
  - スタンプ選択: グリッド表示（24種類の絵文字）
  - コメント入力:
    - ラベル: "コメント・メモ（オプション）"
    - テキストエリア（3行）
    - 文字数カウント表示（最大500文字）
    - 既存のコメントを初期値として表示

- **アクション**
  - キャンセルボタン
  - 保存ボタン（テーマのprimaryグラデーション）

#### バリデーション
- 時間: 最低1秒以上

#### 機能
- 時間変更: 記録の経過時間を更新
- 日付変更: 記録の日付を変更（グラフ/リスト表示も更新）
- タグ変更: 記録のタグを変更
- スタンプ変更: 記録のスタンプを変更/削除
- コメント変更: 記録のコメントを編集/削除

---

### 9. 削除確認モーダル（記録用）
**トリガー**: タイマーカードの削除ボタン（×）

#### 構成
- **ヘッダー**
  - タイトル: "⚠️ 確認"
  - テーマカラーのグラデーション背景

- **メッセージ**
  - 「このタイマーを削除しますか？」
  - タイマー名を表示

- **アクション**
  - キャンセルボタン
  - 削除ボタン（danger用の赤系グラデーション）

---

### 10. 削除確認モーダル（タイマー用）
**トリガー**: タイマーカードの削除ボタン（×）

#### 構成
- **ヘッダー**
  - タイトル: "⚠️ 確認"
  - テーマカラーのグラデーション背景

- **メッセージ**
  - 「このタイマーを削除しますか？」
  - タイマー名を表示

- **アクション**
  - キャンセルボタン
  - 削除ボタン（danger用の赤系グラデーション）

---

### 11. タイマー実行中モーダル（全画面）
**トリガー**: タイマー開始ボタン

#### 構成
- **背景**: タイマー画像をぼかして表示
- **タイマー名**: 上部中央に大きく表示
- **タイマー表示**:
  - 中央に大きな円形
  - 進捗リング（カウントダウンの場合のみ）
  - 時間表示（等幅フォント、大きいサイズ）
- **操作ボタン**:
  - 一時停止/再開ボタン（テーマのaccent→primaryグラデーション）
  - 停止ボタン（danger色）
- **開始時刻表示**: 下部に小さく表示

#### 機能
- 一時停止/再開: タイマーの一時停止と再開
- 停止: 記録保存モーダルを表示してタイマー終了
- カウントダウン: 進捗を円形で視覚化
- ストップウォッチ: 00:00から上昇

#### スタイル
- 背景画像: ぼかし + 暗め（brightness 0.6）
- 文字: 白、シャドウ付き
- 円形プログレス: 白いストローク

---

## 共通デザイン要素

### カラーシステム
#### CSS変数
```css
--theme-gradient: テーマのグラデーション背景
--theme-text-color: テーマに応じた文字色（#333 or #fff）
--theme-text-alpha: テーマに応じた半透明文字色
--theme-primary: メインカラー（明るめ）
--theme-primary-dark: メインカラー（濃いめ）
--theme-accent: アクセントカラー
--theme-success: 成功・開始操作用
--theme-danger: 警告・停止操作用
```

#### 適用ルール
- 背景: 全画面でテーマグラデーション使用
- ボタン:
  - 開始系: success色
  - 停止系: danger色
  - 作成/保存系: primary→primaryDarkグラデーション
  - 一時停止系: accent→primaryグラデーション
  - キャンセル系: 半透明の白
- 強調表示: primary色
- 文字色: テーマに応じて自動調整（明るい背景は黒、暗い背景は白）

### タイポグラフィ
- **見出し**: 大きめ、太字
- **本文**: 標準サイズ
- **数値表示**: 等幅フォント（Courier New）、大きめ
- **ラベル**: 小さめ、中太字

### レスポンシブデザイン
- **ブレークポイント**: 768px
- **モバイル対応**:
  - グリッド: 1列表示
  - フォントサイズ: 縮小
  - パディング: 縮小
  - ボタン: 縦並び

### アニメーション
- **フェードイン**: 0.2-0.3秒
- **スライドアップ**: モーダル表示時
- **ホバー効果**: transform + box-shadow
- **トランジション**: 0.2-0.3秒

### 共通コンポーネント
#### 底部ナビゲーション
- 固定位置（bottom: 0）
- 白背景
- シャドウ付き
- 白ベースのボタン（半透明）

#### ボタン
- 角丸: 10-25px
- パディング: 12-14px
- ホバー: 上方向へ2px移動 + シャドウ
- アクティブ: 元の位置に戻る

#### カード
- 白背景
- 角丸: 15-20px
- シャドウ: 0 5px 15px rgba(0,0,0,0.2)
- ホバー: 上方向へ5px移動

---

## データ構造

### Timer
```typescript
{
  id: string;          // 一意なID（ストップウォッチは "stopwatch-fixed"）
  name: string;        // タイマー名
  duration: number;    // 時間（秒）
  type: string;        // "countdown" または "stopwatch"
  image?: string;      // 画像パス（例: "/images/mogu.jpg"）
  order: number;       // 並び順（デフォルト: 0）
  isFavorite: boolean; // お気に入りフラグ（デフォルト: false）
  records: Record[];   // 記録の配列（レガシー、現在は使用されない）
  // Cosmos DB内部フィールド（自動生成）
  _rid?: string;       // リソースID
  _self?: string;      // セルフリンク
  _etag?: string;      // ETag
  _attachments?: string; // アタッチメント
  _ts?: number;        // タイムスタンプ
}
```

### Record（独立したコンテナに保存）
```typescript
{
  id: string;          // 一意なID
  timerId: string;     // タイマーID
  timerName: string;   // タイマー名
  startTime: string;   // 開始時刻（ISO 8601形式）
  endTime: string;     // 終了時刻（ISO 8601形式）
  duration: number;    // 経過時間（秒）
  date: string;        // 日付（YYYY-MM-DD）
  tag?: string;        // タグ（オプション）
  stamp?: string;      // スタンプ（絵文字、オプション）
  // Cosmos DB内部フィールド（自動生成）
  _rid?: string;
  _self?: string;
  _etag?: string;
  _attachments?: string;
  _ts?: number;
}
```

### Settings
```typescript
{
  id: string;          // 固定値: "app-settings"
  theme: string;       // テーマID（例: "purple", "blue"）
  // Cosmos DB内部フィールド（自動生成）
  _rid?: string;
  _self?: string;
  _etag?: string;
  _attachments?: string;
  _ts?: number;
}
```

### Tag
```typescript
{
  id: string;          // タグ名をそのままIDとして使用
  name: string;        // タグ名
  // Cosmos DB内部フィールド（自動生成）
  _rid?: string;
  _self?: string;
  _etag?: string;
  _attachments?: string;
  _ts?: number;
}
```

### Recipe
```typescript
{
  id: string;           // 一意なID
  name: string;         // レシピ名
  ingredients: string[]; // 材料リスト
  steps: string[];      // 手順リスト
  cookingTime?: number; // 調理時間（分、オプション）
  source?: string;      // 参考URL（オプション）
  tags: string[];       // タグリスト
  isFavorite: boolean;  // お気に入りフラグ
  timesCooked: number;  // 作った回数
  createdAt: string;    // 作成日時（ISO 8601形式）
  // Cosmos DB内部フィールド（自動生成）
  _rid?: string;
  _self?: string;
  _etag?: string;
  _attachments?: string;
  _ts?: number;
}
```

---

## API エンドポイント

### タイマー
- `GET /api/timers`: 全タイマー取得（order順にソート）
- `POST /api/timers`: タイマー作成
- `PUT /api/timers/:id`: タイマー更新
- `DELETE /api/timers/:id`: タイマー削除
- `POST /api/timers/:id/start`: タイマー開始
- `POST /api/timers/:id/stop?tag=xxx&stamp=xxx`: タイマー停止（記録保存、タグとスタンプはオプション）
- `POST /api/timers/reorder`: タイマーの並び順を更新
- `PUT /api/timers/:id/favorite`: お気に入り切り替え
- `GET /api/timers/:id/records`: 特定タイマーの記録取得（レガシー）

### 記録
- `GET /api/records`: 全記録取得（フィルタ: timerId, tag, startDate, endDate）
- `GET /api/records/:id`: 特定記録取得
- `POST /api/records`: 記録作成
- `POST /api/records/manual`: 手動記録作成（stamp含む）
- `PUT /api/records/:id`: 記録更新（duration, date, tag, stamp）
- `DELETE /api/records/:id`: 記録削除
- `GET /api/records/stats/summary`: 記録の統計サマリー取得

### タグ
- `GET /api/timers/tags/all`: 全タグ取得
- `POST /api/timers/tags?tag=xxx`: タグ作成

### 設定
- `GET /api/settings`: 設定取得
- `PUT /api/settings`: 設定更新

### 画像
- `POST /api/upload`: 画像アップロード

### レシピ
- `GET /api/recipes`: 全レシピ取得（フィルタ: favorite, tag, search）
- `GET /api/recipes/:id`: 特定レシピ取得
- `POST /api/recipes`: レシピ作成
- `PUT /api/recipes/:id`: レシピ更新
- `DELETE /api/recipes/:id`: レシピ削除
- `PATCH /api/recipes/:id/favorite`: お気に入り切り替え
- `POST /api/recipes/:id/cook`: 調理記録（timesCooked++）
- `POST /api/recipes/import?url=xxx`: 外部サイトから取り込み
- `POST /api/recipes/suggest?ingredients=xxx`: AI提案
- `GET /api/recipes/recommend`: おすすめレシピ取得（RAGベース、limit, user_id）
- `POST /api/recipes/embeddings/rebuild`: ベクトルDB再構築（管理用）

---

## ユーザーフロー

### タイマー作成 → 実行 → 記録保存
1. タイマー一覧画面で「新規作成」クリック
2. タイマー作成モーダルで名前・時間・画像を設定
3. 「作成」クリックでタイマー追加
4. タイマーカードの「開始」ボタンクリック
5. 全画面タイマー実行モーダル表示
6. タイマー終了後「停止」ボタンクリック
7. 記録保存モーダルでタグ選択（任意）
8. 「保存」クリックで記録追加
9. タイマー一覧画面に戻る

### 記録確認
1. タイマー一覧画面でタイマーカードクリック
2. タイマー詳細画面で記録一覧表示
3. 統計情報と個別記録を確認

### テーマ変更
1. ホーム画面で設定ボタン（⚙️）クリック
2. 設定画面でテーマカラーを選択
3. 即座にアプリ全体のテーマが変更
4. ホームに戻って変更を確認

---

## 今後の拡張予定

### タイマー機能（Phase 1）
- ~~ドラッグ&ドロップ並び替え~~ ✅ 実装済み
- ~~お気に入り機能~~ ✅ 実装済み
- ~~記録の編集機能~~ ✅ 実装済み
- ~~週次・月次レポート~~ ✅ 実装済み
- ~~カレンダービュー~~ ✅ 実装済み
- ~~記録へのスタンプ機能~~ ✅ 実装済み
- ~~ポモドーロアラート音~~ ✅ 実装済み
- ~~マイナスカウント機能~~ ✅ 実装済み
- ~~記録へのコメント・メモ追加~~ ✅ 実装済み

### レシピ機能（Phase 2、実装済み） ✅
- ~~レシピCRUD機能~~ ✅ 実装済み
- ~~レシピ一覧・カード表示~~ ✅ 実装済み
- ~~お気に入り機能~~ ✅ 実装済み
- ~~調理回数カウント~~ ✅ 実装済み
- ~~材料・手順の管理~~ ✅ 実装済み
- ~~検索機能~~ ✅ 実装済み（名前・材料・手順・タグから検索）
- ~~外部レシピサイト連携~~ ✅ 実装済み（クックパッド、楽天レシピ対応）
- ~~AI提案機能~~ ✅ 実装済み（OpenAI API使用）
- **RAG推薦システム** 🚧 実装中
  - ベクトル検索による類似レシピ推薦
  - 調理履歴ベースのパーソナライズ推薦
  - AI生成の推薦理由表示

### レシピRAG推薦システム（Phase 2-3、完了） ✅

#### 概要
調理履歴とレシピデータをベクトル化し、RAGで個別化されたレシピ推薦を提供。

#### アーキテクチャ
1. **Embeddingモジュール** (`backend/embedding_service.py`)
   - Sentence Transformersで日本語テキストをベクトル化
   - モデル: paraphrase-multilingual-MiniLM-L12-v2
   - キャッシュ機能でパフォーマンス向上

2. **ベクトルDBモジュール** (`backend/vector_store.py`)
   - ChromaDBでベクトル保存・検索
   - メタデータ: レシピID、名前、タグ、調理回数、お気に入り
   - 類似度検索（コサイン類似度）

3. **推薦エンジン** (`backend/recommendation_engine.py`)
   - ユーザーの調理履歴から好みを分析
   - ベクトル検索で類似レシピを取得
   - Azure OpenAIで推薦理由を生成（オプション）

#### 推薦ロジック
1. ユーザーが調理したレシピのベクトルを平均化
2. お気に入りレシピに重み付け（2倍）
3. ベクトル検索で上位5-10件を取得
4. 既に調理済みのレシピを除外
5. Azure OpenAIで推薦理由を生成

#### コスト最適化
- Embedding: ローカル実行（$0）
- ベクトルDB: ローカル実行（$0）
- Azure OpenAI: 推薦理由生成のみ（月100回想定、$0.30程度）
- キャッシュ: 同じユーザーの重複リクエストを削減
- **合計想定コスト: 月$2-5**

#### データフロー
```
レシピ作成/更新
  ↓
Embeddingモジュール（ローカル）
  ↓
ChromaDB保存
  ↓
ユーザーが「おすすめ」をリクエスト
  ↓
調理履歴を取得
  ↓
ベクトル検索（類似レシピ）
  ↓
Azure OpenAI（推薦理由生成）← キャッシュチェック
  ↓
推薦結果をフロントエンドに返却
```

#### 実装ステップ
- [x] Phase 1: 依存パッケージインストール（sentence-transformers 3.0.1, chromadb 0.4.18）
- [x] Phase 2: Embeddingモジュール作成（backend/embedding_service.py）
- [x] Phase 3: ベクトルDBモジュール作成（backend/vector_store.py）
- [x] Phase 4: 推薦エンジン作成（backend/recommendation_engine.py）
- [x] Phase 5: 推薦APIエンドポイント追加（/api/recipes/recommend）
- [x] Phase 6: フロントエンド実装（おすすめレシピボタン、推薦モーダル）
- [x] Phase 7: インデックス初期化スクリプト作成（backend/init_vector_store.py）

#### 追加ファイル
- `backend/embedding_service.py`: Embeddingサービス（131行）
- `backend/vector_store.py`: ベクトルストア管理（188行）
- `backend/recommendation_engine.py`: レシピ推薦エンジン（197行）
- `backend/init_vector_store.py`: インデックス初期化スクリプト（58行）
- `backend/chroma_db/`: ChromaDBストレージ（自動生成）

#### 使用方法
1. **初回セットアップ**:
   ```bash
   cd backend
   python init_vector_store.py
   ```
2. **推薦を取得**:
   - フロントエンドで「🔮 おすすめレシピ」ボタンをクリック
   - 調理履歴が多いほど精度が向上
3. **インデックス再構築**:
   - POST `/api/recipes/embeddings/rebuild`を呼び出し

### 今後の実装予定
- 日次リマインダー機能
- ファッション管理機能
- タグごとの集計・統計
- 認証機能
- データのエクスポート/インポート機能

---

## 技術スタック
- **フロントエンド**: React 18, TypeScript, Vite 7.2.2, React Router DOM, Axios
  - ドラッグ&ドロップ: @hello-pangea/dnd v13.1.1
  - グラフ表示: Recharts
- **バックエンド**: FastAPI 0.104.1, Python 3.12, Uvicorn
- **データベース**: Azure Cosmos DB for NoSQL（サーバーレスモード）
  - エンドポイント: my-app-cosmosdb-1516.documents.azure.com
  - データベース名: my-app-db
  - コンテナ: timers, tags, settings, records, recipes（パーティションキー: /id）
  - リージョン: Japan East
  - 注意: ORDER BY句は使用不可（オプショナルフィールドで失敗）、アプリケーション側でソート
- **スタイリング**: CSS（CSS Variables使用）
- **状態管理**: React Hooks（useState, useEffect）
- **環境変数管理**: python-dotenv
- **外部API**:
  - OpenAI API（GPT-3.5-turbo）: AI提案機能
    - 代替案: Azure OpenAI Service（推奨）
      - 同じGPT-3.5-turboモデルをAzure環境で利用
      - 価格: 約$0.0015/1Kトークン（Input）、$0.002/1Kトークン（Output）
      - エンタープライズセキュリティ、データプライバシー、コンプライアンス対応
      - Japan Eastリージョン対応
    - 代替案: Azure AI Language Services（低価格）
      - テキスト分析、要約、キーフレーズ抽出
      - 価格: 無料枠あり（月間5,000テキストレコード）
      - 機能は限定的（レシピ生成には不向き）
- **RAGシステム（レシピ推薦）**:
  - **Embedding**: Sentence Transformers（ローカル実行、無料）
    - モデル: paraphrase-multilingual-MiniLM-L12-v2
    - 日本語対応、384次元ベクトル
  - **ベクトルDB**: ChromaDB（ローカル実行、無料）
    - 永続化: SQLiteバックエンド
    - ストレージ: backend/chroma_db/
  - **推薦生成**: Azure OpenAI（必要時のみ呼び出し）
    - 月100回程度の想定（月$0.30程度）
    - キャッシュ機能で重複リクエスト削減
  - **想定コスト**: 月$2-5程度
- **スクレイピング**:
  - BeautifulSoup4 + requests: レシピ取り込み機能
  - lxml: HTML/XMLパーサー

---